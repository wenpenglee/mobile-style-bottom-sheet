<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bottom Sheet</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --sheet-radius: 20px;
      --handle-color: #d1d5db;
      --bg: #f3f4f6;
      --surface: #ffffff;
      --text-primary: #111827;
      --text-secondary: #6b7280;
      --accent: #6366f1;
      --accent-light: #eef2ff;
      --divider: #e5e7eb;
      --shadow: 0 -4px 32px rgba(0,0,0,0.12);
      --duration: 320ms;
      --ease: cubic-bezier(0.32, 0.72, 0, 1);
    }

    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      overflow: hidden;
    }

    /* â”€â”€ Page content â”€â”€ */
    .page {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 24px;
      user-select: none;
    }

    .page h1 {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
      text-align: center;
    }

    .page p {
      font-size: 14px;
      color: var(--text-secondary);
      text-align: center;
      max-width: 280px;
      line-height: 1.6;
    }

    .open-btn {
      margin-top: 8px;
      padding: 14px 32px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s, background 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .open-btn:active { transform: scale(0.96); background: #4f46e5; }

    /* â”€â”€ Backdrop â”€â”€ */
    .backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--duration) var(--ease);
      z-index: 100;
    }
    .backdrop.visible {
      opacity: 1;
      pointer-events: auto;
    }

    /* â”€â”€ Bottom Sheet â”€â”€ */
    .bottom-sheet {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: var(--surface);
      border-radius: var(--sheet-radius) var(--sheet-radius) 0 0;
      box-shadow: var(--shadow);
      z-index: 110;
      display: flex;
      flex-direction: column;
      max-height: 92dvh;
      /* starts hidden below the viewport */
      transform: translateY(100%);
      transition: transform var(--duration) var(--ease);
      will-change: transform;
      touch-action: none;
    }

    /* snap states */
    .bottom-sheet.snap-peek    { transform: translateY(calc(100% - 100px)); }
    .bottom-sheet.snap-half    { transform: translateY(40%); }
    .bottom-sheet.snap-full    { transform: translateY(0); }
    /* while dragging â€“ no transition */
    .bottom-sheet.dragging     { transition: none; }

    /* â”€â”€ Handle area â”€â”€ */
    .sheet-handle-area {
      flex-shrink: 0;
      padding: 12px 0 8px;
      display: flex;
      justify-content: center;
      cursor: grab;
    }
    .sheet-handle-area:active { cursor: grabbing; }

    .sheet-handle {
      width: 40px;
      height: 4px;
      border-radius: 2px;
      background: var(--handle-color);
      transition: background 0.15s;
    }
    .sheet-handle-area:hover .sheet-handle { background: #9ca3af; }

    /* â”€â”€ Sheet Header â”€â”€ */
    .sheet-header {
      flex-shrink: 0;
      padding: 4px 20px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sheet-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .sheet-close {
      width: 30px; height: 30px;
      border: none;
      background: var(--bg);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      font-size: 16px;
      color: var(--text-secondary);
      transition: background 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .sheet-close:hover { background: var(--divider); }

    /* â”€â”€ Scrollable body â”€â”€ */
    .sheet-body {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      padding: 0 20px 32px;
    }
    .sheet-body::-webkit-scrollbar { display: none; }

    /* â”€â”€ Snap indicator pills â”€â”€ */
    .snap-indicator {
      display: flex;
      gap: 6px;
      justify-content: center;
      padding: 0 0 12px;
    }

    .snap-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--divider);
      transition: background 0.2s, transform 0.2s;
    }
    .snap-dot.active {
      background: var(--accent);
      transform: scale(1.3);
    }

    /* â”€â”€ List items â”€â”€ */
    .sheet-section-label {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin: 20px 0 10px;
    }

    .sheet-list {
      list-style: none;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--divider);
    }

    .sheet-list li {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 16px;
      background: var(--surface);
      cursor: pointer;
      transition: background 0.12s;
      -webkit-tap-highlight-color: transparent;
    }
    .sheet-list li + li { border-top: 1px solid var(--divider); }
    .sheet-list li:active { background: var(--accent-light); }

    .item-icon {
      width: 38px; height: 38px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .item-text { flex: 1; }
    .item-text strong { display: block; font-size: 15px; color: var(--text-primary); font-weight: 500; }
    .item-text span   { display: block; font-size: 12px; color: var(--text-secondary); margin-top: 1px; }

    .item-chevron { color: #d1d5db; font-size: 14px; }

    /* â”€â”€ Action row â”€â”€ */
    .action-row {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .action-btn {
      flex: 1;
      padding: 14px;
      border-radius: 14px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.12s, opacity 0.12s;
      -webkit-tap-highlight-color: transparent;
    }
    .action-btn:active { transform: scale(0.97); opacity: 0.85; }
    .action-btn.primary   { background: var(--accent); color: #fff; }
    .action-btn.secondary { background: var(--bg); color: var(--text-primary); }
  </style>
</head>
<body>

<!-- Page behind the sheet -->
<div class="page">
  <h1>Bottom Sheet Demo</h1>
  <p>Drag the sheet to snap between positions, or tap the backdrop to dismiss it.</p>
  <button class="open-btn" id="openBtn">Open Bottom Sheet</button>
</div>

<!-- Backdrop -->
<div class="backdrop" id="backdrop"></div>

<!-- Bottom Sheet -->
<div class="bottom-sheet" id="bottomSheet" aria-modal="true" role="dialog" aria-label="Options">

  <!-- Drag handle -->
  <div class="sheet-handle-area" id="handleArea">
    <div class="sheet-handle"></div>
  </div>

  <!-- Snap indicator -->
  <div class="snap-indicator">
    <div class="snap-dot" data-snap="peek"></div>
    <div class="snap-dot active" data-snap="half"></div>
    <div class="snap-dot" data-snap="full"></div>
  </div>

  <!-- Header -->
  <div class="sheet-header">
    <span class="sheet-title">Choose an Action</span>
    <button class="sheet-close" id="closeBtn" aria-label="Close">&#x2715;</button>
  </div>

  <!-- Scrollable content -->
  <div class="sheet-body">

    <div class="sheet-section-label">Quick Actions</div>
    <ul class="sheet-list">
      <li>
        <div class="item-icon" style="background:#eef2ff;">ğŸ“¤</div>
        <div class="item-text">
          <strong>Share</strong>
          <span>Send to friends or apps</span>
        </div>
        <span class="item-chevron">â€º</span>
      </li>
      <li>
        <div class="item-icon" style="background:#fef3c7;">â­</div>
        <div class="item-text">
          <strong>Add to Favourites</strong>
          <span>Save for later</span>
        </div>
        <span class="item-chevron">â€º</span>
      </li>
      <li>
        <div class="item-icon" style="background:#ecfdf5;">ğŸ”—</div>
        <div class="item-text">
          <strong>Copy Link</strong>
          <span>Copy to clipboard</span>
        </div>
        <span class="item-chevron">â€º</span>
      </li>
    </ul>

    <div class="sheet-section-label">More Options</div>
    <ul class="sheet-list">
      <li>
        <div class="item-icon" style="background:#f0fdf4;">ğŸ“‹</div>
        <div class="item-text">
          <strong>Duplicate</strong>
          <span>Make a copy of this item</span>
        </div>
        <span class="item-chevron">â€º</span>
      </li>
      <li>
        <div class="item-icon" style="background:#eff6ff;">âœï¸</div>
        <div class="item-text">
          <strong>Rename</strong>
          <span>Change the display name</span>
        </div>
        <span class="item-chevron">â€º</span>
      </li>
      <li>
        <div class="item-icon" style="background:#fef2f2;">ğŸ—‘ï¸</div>
        <div class="item-text">
          <strong>Delete</strong>
          <span>Permanently remove</span>
        </div>
        <span class="item-chevron">â€º</span>
      </li>
    </ul>

    <div class="action-row">
      <button class="action-btn secondary" id="cancelBtn">Cancel</button>
      <button class="action-btn primary">Confirm</button>
    </div>

  </div><!-- /.sheet-body -->
</div><!-- /.bottom-sheet -->

<script>
$(function () {

  // â”€â”€ Snap configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Each snap maps to a CSS class; "peek" shows just the handle bar.
  const SNAPS = ['peek', 'half', 'full'];
  let currentSnap = null;          // null = hidden
  let rafId = null;

  const $sheet    = $('#bottomSheet');
  const $backdrop = $('#backdrop');
  const $handle   = $('#handleArea');
  const $body     = $sheet.find('.sheet-body');

  // â”€â”€ Open / close helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function open(snap = 'half') {
    $backdrop.addClass('visible');
    applySnap(snap);
  }

  function close() {
    $sheet.removeClass('dragging snap-peek snap-half snap-full');
    $backdrop.removeClass('visible');
    currentSnap = null;
    updateDots(null);
    // force back below viewport
    $sheet.css('transform', '');
  }

  function applySnap(snap) {
    $sheet
      .removeClass('dragging snap-peek snap-half snap-full')
      .addClass('snap-' + snap)
      .css('transform', '');
    currentSnap = snap;
    updateDots(snap);
  }

  function updateDots(snap) {
    $('.snap-dot').each(function () {
      $(this).toggleClass('active', $(this).data('snap') === snap);
    });
  }

  // â”€â”€ Drag-to-snap logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let drag = {
    active: false,
    startY: 0,
    startTranslate: 0,
    sheetH: 0,
    lastY: 0,
    velocity: 0,
  };

  // Compute the translateY that each snap class produces at runtime
  function getSnapTranslate(snap) {
    const h = $sheet[0].offsetHeight;
    switch (snap) {
      case 'peek': return h - 100;
      case 'half': return h * 0.40;
      case 'full': return 0;
    }
    return h;
  }

  // Read the *current* translateY (works during drag where transform is inline)
  function getCurrentTranslate() {
    const style = window.getComputedStyle($sheet[0]);
    const m = new DOMMatrix(style.transform);
    return m.m42; // translateY
  }

  function onDragStart(clientY) {
    drag.active   = true;
    drag.startY   = clientY;
    drag.sheetH   = $sheet[0].offsetHeight;
    drag.startTranslate = getCurrentTranslate();
    drag.lastY    = clientY;
    drag.velocity = 0;
    $sheet.addClass('dragging');
  }

  function onDragMove(clientY) {
    if (!drag.active) return;
    drag.velocity = clientY - drag.lastY;
    drag.lastY = clientY;

    let next = drag.startTranslate + (clientY - drag.startY);
    // Rubber-band resistance above full-open (translateY < 0)
    if (next < 0) next = next * 0.25;
    // Clamp so it can't fly off screen completely
    next = Math.min(next, drag.sheetH + 60);

    cancelAnimationFrame(rafId);
    rafId = requestAnimationFrame(() => {
      $sheet.css('transform', `translateY(${next}px)`);
    });
  }

  function onDragEnd() {
    if (!drag.active) return;
    drag.active = false;
    $sheet.removeClass('dragging');

    const currentY = getCurrentTranslate();
    const h = drag.sheetH;

    // Dismiss if dragged more than 60 % down OR fast flick downward
    if (currentY > h * 0.62 || drag.velocity > 18) {
      close();
      return;
    }

    // Find the nearest snap point
    const snapYMap = SNAPS.reduce((acc, s) => {
      acc[s] = getSnapTranslate(s);
      return acc;
    }, {});

    // Bias toward the flick direction
    const biased = currentY + drag.velocity * 6;
    let nearest = SNAPS[0];
    let minDist = Infinity;
    SNAPS.forEach(s => {
      const d = Math.abs(biased - snapYMap[s]);
      if (d < minDist) { minDist = d; nearest = s; }
    });

    applySnap(nearest);
  }

  // â”€â”€ Pointer events (covers both touch + mouse) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  $handle[0].addEventListener('pointerdown', function (e) {
    // Only begin drag from the handle when scrolled to top, or always from handle
    e.preventDefault();
    $handle[0].setPointerCapture(e.pointerId);
    onDragStart(e.clientY);
  }, { passive: false });

  $sheet[0].addEventListener('pointermove', function (e) {
    onDragMove(e.clientY);
  });

  $sheet[0].addEventListener('pointerup',   onDragEnd);
  $sheet[0].addEventListener('pointercancel', onDragEnd);

  // Allow dragging from sheet body only when scrolled to the top
  $body[0].addEventListener('pointerdown', function (e) {
    if ($body[0].scrollTop === 0) {
      onDragStart(e.clientY);
    }
  });

  // â”€â”€ Snap-dot clicks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  $('.snap-dot').on('click', function () {
    applySnap($(this).data('snap'));
  });

  // â”€â”€ Button wiring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  $('#openBtn').on('click',   () => open('half'));
  $('#closeBtn').on('click',  close);
  $('#cancelBtn').on('click', close);
  $backdrop.on('click', close);

  // Prevent sheet clicks from bubbling to backdrop
  $sheet.on('click', e => e.stopPropagation());

  // â”€â”€ Keyboard accessibility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  $(document).on('keydown', function (e) {
    if (e.key === 'Escape' && currentSnap) close();
  });

});
</script>
</body>
</html>
